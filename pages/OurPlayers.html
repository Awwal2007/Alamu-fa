<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Squad - Alamu Football Academy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="/image/alamu.png" type="image/png">
    <style>
        :root {
            --gold: #007BFF;
            --red: #003366;
            --white: #FFFFFF;
            --dark-red: #002244;
            --light-gold: #E6F2FF;
            --dark-gold: #0056B3;
            --light-gray: #f5f5f5;
            --dark-gray: #333;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--light-gray); color: var(--dark-gray); line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; } 
        
        /* Header */
        header { background: linear-gradient(135deg, var(--gold), var(--dark-red)); color: var(--white); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo-text h1 { font-size: 1.2rem; font-weight: 700; }
        .logo-text p { font-size: 0.9rem; opacity: 0.9; }
        .logo-image img { width: 100px; height: auto; transition: transform 0.3s; }
        .logo-image img:hover { transform: scale(1.1); }
        
        nav ul { display: flex; list-style: none; gap: 25px; }
        nav a { color: var(--white); text-decoration: none; font-weight: 500; font-size: 1.1rem; transition: all 0.3s ease; padding: 5px 10px; border-radius: 4px; }
        nav a:hover { background: rgba(255, 255, 255, 0.1); color: var(--gold); }
        .mobile-menu-btn { display: none; background: none; border: none; color: var(--white); font-size: 1.5rem; cursor: pointer; }

        /* Banner */
        .page-banner { background: linear-gradient(rgba(0, 34, 68, 0.8), rgba(0, 51, 102, 0.8)), url('image/playes1.jpg'); background-size: cover; background-position: center; padding: 80px 0; text-align: center; color: var(--white); }
        .page-banner h1 { font-size: 3rem; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; }

        /* Squad Section */
        .squad-section { padding: 60px 0; }
        
        /* Add Player Button */
        .add-player-container { display: flex; justify-content: center; margin-bottom: 30px; }
        .add-player-btn { background: var(--dark-red); color: var(--white); padding: 12px 30px; border-radius: 50px; border: none; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 10px; font-size: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .add-player-btn:hover { background: var(--gold); transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }

        /* Filters */
        .squad-filters { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-bottom: 50px; }
        .filter-btn { background: var(--white); border: 2px solid var(--gold); color: var(--gold); padding: 10px 25px; border-radius: 30px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; font-size: 0.9rem; }
        .filter-btn:hover, .filter-btn.active { background: var(--gold); color: var(--white); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3); }

        /* Grid */
        .players-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        
        /* Player Card */
        .player-card { background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: all 0.3s ease; position: relative; border-bottom: 4px solid var(--gold); }
        .player-card:hover { transform: translateY(-210px); box-shadow: 0 15px 30px rgba(0,0,0,0.15); }
        .card-img-wrapper { height: 350px; width: 100%; overflow: hidden; position: relative; background: #e0e0e0; }
        .card-img-wrapper img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .player-card:hover .card-img-wrapper img { transform: scale(1.05); }
        .player-details { padding: 20px; text-align: center; }
        .player-name { font-size: 1.4rem; color: var(--dark-red); margin-bottom: 5px; font-weight: 700; }
        .player-pos-label { display: inline-block; background: var(--light-gold); color: var(--dark-gold); padding: 4px 12px; border-radius: 4px; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; margin-bottom: 15px; }
        .player-stats-row { display: flex; justify-content: space-around; border-top: 1px solid #eee; padding-top: 15px; }
        .p-stat { display: flex; flex-direction: column; }
        .p-stat span:first-child { font-size: 1.1rem; font-weight: 700; color: var(--dark-gray); }
        .p-stat span:last-child { font-size: 0.75rem; color: #888; text-transform: uppercase; }

        /* --- PROFESSIONAL MODAL STYLES --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); }
        .modal-content { background-color: var(--white); margin: 3% auto; padding: 0; border-radius: 15px; width: 90%; max-width: 700px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); animation: slideDown 0.4s ease; }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { background: linear-gradient(135deg, var(--gold), var(--dark-red)); padding: 20px 30px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center; color: var(--white); }
        .modal-header h2 { margin: 0; font-size: 1.5rem; }
        .close-modal { color: var(--white); font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-body { padding: 30px; max-height: 80vh; overflow-y: auto; }

        /* Form Styling */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .full-width { grid-column: 1 / -1; }
        .form-group { margin-bottom: 5px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark-gray); font-size: 0.9rem; }
        .form-control { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; background: #fafafa; }
        .form-control:focus { border-color: var(--gold); outline: none; background: #fff; }
        .submit-btn-form { background: var(--red); color: var(--white); width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-top: 20px; transition: background 0.3s; }
        .submit-btn-form:hover { background: var(--gold); }
        
        /* Section Dividers in Form */
        .form-section-title { grid-column: 1 / -1; margin-top: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--light-gold); font-size: 1.1rem; color: var(--dark-gold); font-weight: 700; }
        
        /* Hidden Class for Logic */
        .hidden { display: none; }

        /* CTA */
        .join-cta { background: var(--white); padding: 60px 0; text-align: center; margin-top: 40px; }
        .cta-btn { display: inline-block; background: var(--red); color: var(--white); padding: 15px 40px; border-radius: 50px; text-decoration: none; font-weight: 600; transition: background 0.3s; margin-top: 20px; }
        .cta-btn:hover { background: var(--gold); }

        /* Footer */
        footer { background: linear-gradient(135deg, var(--red), var(--dark-red)); color: var(--white); padding: 60px 0 20px; }
        footer a { color: var(--white); text-decoration: none; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; margin-bottom: 40px; }
        .footer-column h3 { font-size: 1.5rem; margin-bottom: 20px; position: relative; padding-bottom: 10px; }
        .footer-column h3::after { content: ''; position: absolute; width: 50px; height: 3px; background: var(--gold); bottom: 0; left: 0; }
        .contact-info li { margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .copyright { text-align: center; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); opacity: 0.8; }
        
        @media (max-width: 768px) {
            nav ul { display: none; position: absolute; top: 100%; left: 0; width: 100%; background: var(--dark-red); flex-direction: column; padding: 20px; gap: 15px; }
            nav ul.show { display: flex; }
            .mobile-menu-btn { display: block; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class=" container logo">
                <a a href="/index.html" class="logo-image">
                    <img src="/image/alamu.png" alt="AFA Logo">
                </a>
                <div class="logo-text">
                    <h1>Alamu Football Academy </h1>
                    <p>Our Pride ThierÂ Fear</p>
                </div>
            </div>
            
            <nav class="container">
                <ul id="nav-menu">
                    <li><a href="/index.html"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="/pages/about.html"><i class="fas fa-info-circle"></i> About</a></li>
                    <li><a href="pages/OurPlayers.html" style="color: var(--gold);"><i class="fas fa-users"></i> Our Players</a></li>
                    <li><a href="/pages/coaches.html"><i class="fas fa-chalkboard-teacher"></i> Coaches</a></li>
                    <li><a href="/pages/gallery.html"><i class="fas fa-images"></i> Gallery</a></li>
                    <li><a href="/pages/news.html"><i class="fas fa-newspaper"></i> News</a></li>
                    <li><a href="/pages/contact.html"><i class="fas fa-envelope"></i> Contact</a></li>
                    
                </ul>
                <button class="mobile-menu-btn" id="mobile-menu">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <div class="page-banner">
        <div class="container">
            <h1>Our Players</h1>
            <p>Meet the future stars of Nigerian Football</p>
        </div>
    </div>

    <section class="squad-section">
        <div class="container">
            <div class="squad-filters">
                <button class="filter-btn active" onclick="filterPlayers('all')">All Players</button>
                <button class="filter-btn" onclick="filterPlayers('Goalkeeper')">Goalkeepers</button>
                <button class="filter-btn" onclick="filterPlayers('Defender')">Defenders</button>
                <button class="filter-btn" onclick="filterPlayers('Midfielder')">Midfielders</button>
                <button class="filter-btn" onclick="filterPlayers('Forward')">Forwards</button>
            </div>

            <div class="players-grid" id="players-grid">
                <div style="text-align:center; width:100%; grid-column: 1/-1;">
                    <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--gold);"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- <section class="join-cta">
        <div class="container">
            <h2>Do you have what it takes?</h2>
            <p style="margin-top: 10px; max-width: 600px; margin-left: auto; margin-right: auto; color: #555;">
                We are constantly looking for young talents to join our ranks. Check our requirements and trial dates.
            </p>
            <button class="cta-btn" id="joinUsBtn">Join Us <i class="fas fa-user-plus"></i></button>
        </div>
    </section> -->

    <div id="joinUsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeModal">&times;</span>
            <h2>Join Alamu Football Academy</h2>
            <p>Fill out the form below to express your interest in joining our academy. We'll get back to you soon!</p>
            <form id="joinUsForm">
                <div class="form-group">
                    <label for="fullName">Full Name *</label>
                    <input type="text" id="fullName" name="fullName" required>
                </div>
                <div class="form-group">
                    <label for="address">Address</label>
                    <input type="text" id="address" name="address">
                </div>
                <div class="form-group">
                    <label for="dateOfBirth">Date Of Birth</label>
                    <input type="date" id="dateOfBirth" name="dateOfBirth">
                </div>
                <div class="form-group">
                    <label for="parentFullName">Parent Full Name</label>
                    <input type="text" id="parentFullName" name="parentFullName">
                </div>
                <div class="form-group">
                    <label for="parentAddress">Parent Address</label>
                    <input type="text" id="parentAddress" name="parentAddress">
                </div>
                <div class="form-group">
                    <label for="parentPhone1">Parent Phone Number 1</label>
                    <input type="tel" id="parentPhone1" name="parentPhone1">
                </div>
                <div class="form-group">
                    <label for="parentPhone2">Parent Phone Number 2</label>
                    <input type="tel" id="parentPhone2" name="parentPhone2">
                </div>
                <div class="form-group">
                    <label for="studentOrGraduate">Student or Graduate *</label>
                    <select id="studentOrGraduate" name="studentOrGraduate" required>
                        <option value="">Select Option</option>
                        <option value="student">Student</option>
                        <option value="graduate">Graduate</option>
                    </select>
                </div>
                <div class="form-group conditional-field" id="studentFields">
                    <label for="schoolName">School Name</label>
                    <input type="text" id="schoolName" name="schoolName">
                    <label for="schoolClass">Class</label>
                    <input type="text" id="schoolClass" name="schoolClass">
                </div>
                <div class="form-group conditional-field" id="graduateFields">
                    <label for="gradType">University or Occupation *</label>
                    <select id="gradType" name="gradType" required>
                        <option value="">Select Option</option>
                        <option value="university">University</option>
                        <option value="occupation">Occupation</option>
                    </select>
                </div>
                <div class="form-group conditional-field" id="universityFields">
                    <label for="universityName">University Name</label>
                    <input type="text" id="universityName" name="universityName">
                    <label for="department">Department</label>
                    <input type="text" id="department" name="department">
                </div>
                <div class="form-group conditional-field" id="occupationFields">
                    <label for="job">What Job</label>
                    <input type="text" id="job" name="job">
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="photograph">Photograph</label>
                    <input type="file" id="photograph" name="photograph" accept="image/*">
                </div>
                <div class="form-group">
                    <label for="previousAcademy">Previous Academy or Club</label>
                    <input type="text" id="previousAcademy" name="previousAcademy">
                </div>
                <div class="form-group">
                    <label for="position">Preferred Position</label>
                    <select id="position" name="position">
                        <option value="">Select Position</option>
                        <option value="Goalkeeper">Goalkeeper</option>
                        <option value="Defender">Defender</option>
                        <option value="Midfielder">Midfielder</option>
                        <option value="Forward">Forward</option>
                        <option value="Not Sure">Not Sure</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="experience">Football Experience</label>
                    <select id="experience" name="experience">
                        <option value="">Select Experience Level</option>
                        <option value="Beginner">Beginner</option>
                        <option value="Intermediate">Intermediate</option>
                        <option value="Advanced">Advanced</option>
                        <option value="Professional">Professional</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="message">Additional Message</label>
                    <textarea id="message" name="message" rows="4" placeholder="Tell us about yourself, your goals, or any questions you have..."></textarea>
                </div>
                <button type="submit" class="submit-btn">Submit Application</button>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Contact Information</h3>
                    <ul class="contact-info">
                        <li><i class="fas fa-map-marker-alt"></i>  Telu Football Club, Iwo, Osun State, Nigeria</li>
                        <li><i class="fas fa-phone"></i> +234 808 574 2261</li>
                        <li><i class="fas fa-envelope"></i> telufciwo@gmail.com</li>
                    </ul>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="contact-info">
                        <li><a href="/index.html">Home</a></li>
                        <li><a href="/pages/about.html">About </a></li>
                        <li><a href="/pages/OurPlayers.html">Our Players</a></li>
                        <li><a href="/pages/activities.html">Activities</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Visit The Academy</h3>
                    <p>The Alamu Football Academy is open to visitors and prospective talents by appointment. Experience the passion and dedication of our team.</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 Alamu Football Academy - All Rights Reserved | Designed with <i class="fas fa-heart" style="color: var(--gold);"></i> for the Game</p>
            </div>
        </div>
    </footer>

    <script>
        // Mobile Menu Toggle
        const mobileMenuBtn = document.getElementById('mobile-menu');
        const navMenu = document.getElementById('nav-menu');
        mobileMenuBtn.addEventListener('click', () => { navMenu.classList.toggle('show'); });

        // Helper function to read file as a Base64 data URL string (Firestore compatible)
        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                if (!file) {
                    resolve(null);
                    return;
                }
                // Add a size check to prevent massive files from crashing Firestore (max 1MB per document)
                // 500KB limit as a practical safety measure, considering Base64 encoding overhead
                const MAX_FILE_SIZE_BYTES = 500 * 1024; 
                if (file.size > MAX_FILE_SIZE_BYTES) { 
                    reject(new Error(`File "${file.name}" is too large (${(file.size / 1024).toFixed(2)} KB). Maximum allowed size is ${MAX_FILE_SIZE_BYTES / 1024} KB.`));
                    return;
                }
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>

    <script>
        // Modal functionality
        const joinUsBtn = document.getElementById('joinUsBtn');
        const joinUsModal = document.getElementById('joinUsModal');
        const closeModal = document.getElementById('closeModal');
        const joinUsForm = document.getElementById('joinUsForm');

        // Open modal
        joinUsBtn.addEventListener('click', () => {
            joinUsModal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        });

        // Close modal
        closeModal.addEventListener('click', () => {
            joinUsModal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
        });

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === joinUsModal) {
                joinUsModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        // Conditional field display logic
        const studentOrGraduateSelect = document.getElementById('studentOrGraduate');
        const gradTypeSelect = document.getElementById('gradType');

        studentOrGraduateSelect.addEventListener('change', () => {
            const value = studentOrGraduateSelect.value;
            // Hide all conditional fields first
            document.getElementById('studentFields').style.display = 'none';
            document.getElementById('graduateFields').style.display = 'none';
            document.getElementById('universityFields').style.display = 'none';
            document.getElementById('occupationFields').style.display = 'none';

            if (value === 'student') {
                document.getElementById('studentFields').style.display = 'block';
            } else if (value === 'graduate') {
                document.getElementById('graduateFields').style.display = 'block';
                // Reset internal graduate fields when switching
                gradTypeSelect.value = "";
            }
        });

        gradTypeSelect.addEventListener('change', () => {
            const value = gradTypeSelect.value;
            // Hide internal graduate fields first
            document.getElementById('universityFields').style.display = 'none';
            document.getElementById('occupationFields').style.display = 'none';

            if (value === 'university') {
                document.getElementById('universityFields').style.display = 'block';
            } else if (value === 'occupation') {
                document.getElementById('occupationFields').style.display = 'block';
            }
        });
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getFirestore, collection, getDocs, orderBy, query, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB9JVWFn9a6RjC-_7-RweStkBTbE9P1F1k",
            authDomain: "alamu-fc.firebaseapp.com",
            projectId: "alamu-fc",
            storageBucket: "alamu-fc.firebasestorage.app",
            messagingSenderId: "519243570056",
            appId: "1:519243570056:web:b4d95c7266beb61757f83d",
            measurementId: "G-3HDT240BLK"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Helper function to resize and encode image
        function resizeImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 1920;
                        const MAX_HEIGHT = 1080;
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/webp', 0.8));
                    };
                    img.onerror = reject;
                    img.src = event.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Handle form submission
        document.getElementById('joinUsForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            // Get form data
            const formData = new FormData(joinUsForm);
            const data = Object.fromEntries(formData.entries());

            let errors = [];

            // Core Required Fields Check
            if (!data.fullName) errors.push('Full Name');
            if (!data.email) errors.push('Email');
            if (!data.phone) errors.push('Phone');

            // Special Check for required Select field
            if (!data.studentOrGraduate || data.studentOrGraduate === "") errors.push('Student or Graduate');

            // Conditional Fields Check
            if (data.studentOrGraduate === 'student') {
                if (!data.schoolName) errors.push('School Name');
                if (!data.schoolClass) errors.push('Class');
            } else if (data.studentOrGraduate === 'graduate') {
                if (!data.gradType || data.gradType === "") errors.push('University or Occupation');

                if (data.gradType === 'university') {
                    if (!data.universityName) errors.push('University Name');
                    if (!data.department) errors.push('Department');
                } else if (data.gradType === 'occupation') {
                    if (!data.job) errors.push('Job');
                }
            }

            if (errors.length > 0) {
                alert(`Please fill in all required fields: ${errors.join(', ')}`);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Application';
                return;
            }

            try {
                // Handle photograph upload
                let photographUrl = '';
                const photographFile = document.getElementById('photograph').files[0];
                if (photographFile) {
                    photographUrl = await resizeImage(photographFile);
                }

                // Prepare data for Firebase
                const applicationData = {
                    fullName: data.fullName,
                    address: data.address || '',
                    dob: data.dateOfBirth || null,
                    parentFullName: data.parentFullName || '',
                    parentAddress: data.parentAddress || '',
                    parentPhone1: data.parentPhone1 || '',
                    parentPhone2: data.parentPhone2 || '',
                    studentOrGraduate: data.studentOrGraduate,
                    schoolName: data.schoolName || '',
                    schoolClass: data.schoolClass || '',
                    gradType: data.gradType || '',
                    universityName: data.universityName || '',
                    department: data.department || '',
                    job: data.job || '',
                    email: data.email,
                    phone: data.phone,
                    photograph: photographUrl,
                    previousAcademy: data.previousAcademy || '',
                    position: data.position || '',
                    experience: data.experience || '',
                    message: data.message || '',
                    createdAt: serverTimestamp()
                };

                // Submit to Firebase
                await addDoc(collection(db, 'applications'), applicationData);

                alert('Thank you for your interest! We will contact you soon.');

                // Reset form and close modal
                joinUsForm.reset();
                document.getElementById('studentFields').style.display = 'none';
                document.getElementById('graduateFields').style.display = 'none';
                document.getElementById('universityFields').style.display = 'none';
                document.getElementById('occupationFields').style.display = 'none';
                document.getElementById('joinUsModal').style.display = 'none';
                document.body.style.overflow = 'auto';

            } catch (error) {
                console.error('Error submitting application:', error);
                alert('An error occurred while submitting your application. Please try again.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Application';
            }
        });

        document.addEventListener('DOMContentLoaded', loadPlayers);

        async function loadPlayers() {
            const grid = document.getElementById('players-grid');
            grid.innerHTML = '<div style="text-align:center; width:100%; grid-column: 1/-1;"><i class="fas fa-spinner fa-spin fa-2x" style="color: var(--gold);"></i></div>';

            try {
                // Load players from the 'players' collection
                const q = query(collection(db, 'players'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    grid.innerHTML = '<div style="text-align:center; width:100%; grid-column: 1/-1; color:#777;">No players have been added yet.</div>';
                    return;
                }

                grid.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    renderPlayerCard(data, grid);
                });

            } catch (error) {
                console.error("Error loading players:", error);
                grid.innerHTML = '<div style="text-align:center; width:100%; grid-column: 1/-1; color:red;">Could not load player data.</div>';
            }
        }

        function renderPlayerCard(data, container) {
            const imgSrc = data.image || data.img || 'image/players .jpg';
            const card = document.createElement('div');
            card.className = 'player-card';
            card.setAttribute('data-position', data.position || 'Unknown');
            
            // Calculate age from date of birth
            let ageDisplay = '--';
            if (data.dateOfBirth) {
                const birthDate = new Date(data.dateOfBirth);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                ageDisplay = age;
            }
            
            // Generate a jersey number based on player name for display
            const jerseyNumber = data.name ? 
                data.name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) % 99 + 1 : 
                0;

            card.innerHTML = `
                
                <div class="card-img-wrapper">
                    <img src="${imgSrc}" alt="${data.name}" onerror="this.src='image/players .jpg'">
                </div>
                <div class="player-details">
                    <div class="player-name">${data.name || 'Unknown Player'}</div>
                    <div class="player-pos-label">${data.position || 'Position'}</div>
                    <div class="player-stats-row">
                        <div class="p-stat"><span>${ageDisplay}</span><span>Age</span></div>
                        <div class="p-stat"><span>${data.nationality || '--'}</span><span>Nationality</span></div>
                        <div class="p-stat"><span>${data.position?.substring(0, 3) || 'POS'}</span><span>Position</span></div>
                    </div>
                </div>
            `;
            container.appendChild(card);
        }

        window.filterPlayers = function(category) {
            const cards = document.querySelectorAll('.player-card');
            const buttons = document.querySelectorAll('.filter-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }

            cards.forEach(card => {
                const position = card.getAttribute('data-position');
                if (category === 'all' || position === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        };
    </script>
</body>
</html>